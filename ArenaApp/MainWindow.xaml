<Window x:Class="ArenaApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vlc="clr-namespace:LibVLCSharp.WPF;assembly=LibVLCSharp.WPF"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ArenaApp"
        mc:Ignorable="d"
        WindowState="Maximized"
        Title="ArenaApp - Медиаплеер" Height="450" Width="800" Closing="Window_Closing">
    <Window.Resources>
        <!-- ====== MENU (верхняя панель File/Edit) ====== -->
        <Style TargetType="{x:Type Menu}">
            <Setter Property="Background" Value="{StaticResource DarkPanelBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>

        <!-- ====== MENUITEM (и верхние, и выпадающие пункты) ====== -->
        <Style TargetType="{x:Type MenuItem}">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <Grid>
                            <!-- Сам пункт -->
                            <Border x:Name="Bd"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="Transparent"
                                    BorderThickness="1"
                                    SnapsToDevicePixels="True">
                                <Grid Margin="2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Иконка (если будет) -->
                                    <ContentPresenter Grid.Column="0"
                                                      ContentSource="Icon"
                                                      Margin="0,0,8,0"
                                                      VerticalAlignment="Center"/>

                                    <!-- Текст -->
                                    <ContentPresenter Grid.Column="1"
                                                      ContentSource="Header"
                                                      RecognizesAccessKey="True"
                                                      VerticalAlignment="Center"/>

                                    <!-- Стрелка подменю -->
                                    <Path x:Name="Arrow"
                                          Grid.Column="2"
                                          Width="6" Height="10"
                                          Margin="10,0,0,0"
                                          VerticalAlignment="Center"
                                          Fill="{StaticResource TextSecondaryBrush}"
                                          Data="M 0 0 L 4 5 L 0 10 Z"
                                          Visibility="Collapsed"/>
                                </Grid>
                            </Border>

                            <!-- Выпадающее подменю -->
                            <Popup x:Name="PART_Popup"
                                   IsOpen="{TemplateBinding IsSubmenuOpen}"
                                   Placement="Right"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Fade">
                                <Border Background="{StaticResource DarkPanelBrush}"
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        BorderThickness="1"
                                        SnapsToDevicePixels="True">
                                    <ScrollViewer Margin="4"
                                                  SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True"
                                                    KeyboardNavigation.DirectionalNavigation="Cycle"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <!-- Если это верхний пункт меню (File/Edit), то подменю открывается вниз -->
                            <Trigger Property="Role" Value="TopLevelHeader">
                                <Setter TargetName="PART_Popup" Property="Placement" Value="Bottom"/>
                                <Setter TargetName="Arrow" Property="Visibility" Value="Collapsed"/>
                                <Setter Property="Padding" Value="12,6"/>
                            </Trigger>

                            <!-- Если это пункт с подменю -->
                            <Trigger Property="Role" Value="SubmenuHeader">
                                <Setter TargetName="Arrow" Property="Visibility" Value="Visible"/>
                            </Trigger>

                            <!-- Hover -->
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource DarkHoverBrush}"/>
                            </Trigger>

                            <!-- Disabled: делаем читабельным на тёмном фоне -->
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                <Setter TargetName="Arrow" Property="Fill" Value="{StaticResource TextSecondaryBrush}"/>
                                <Setter TargetName="Bd" Property="Opacity" Value="0.7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ====== SEPARATOR в меню ====== -->
        <Style TargetType="{x:Type Separator}">
            <Setter Property="Margin" Value="6,4"/>
            <Setter Property="Background" Value="{StaticResource DarkBorderBrush}"/>
            <Setter Property="Height" Value="1"/>
        </Style>
    </Window.Resources>
    <Grid Background="{StaticResource DarkBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Меню File и Edit -->
        <Menu Grid.Row="0">
            <MenuItem Header="File">
                <MenuItem Header="New Project" Click="NewProject_Click"/>
                <MenuItem Header="Open Project" Click="OpenProject_Click"/>
                <MenuItem Header="Save Project" Click="SaveProject_Click"/>
                <Separator/>
                <MenuItem Header="Exit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="Edit" Name="EditMenuItem">
                <MenuItem Header="Экраны" Name="ScreensMenuItem">
                    <!-- Подменю экранов будет заполнено динамически -->
                </MenuItem>
                <MenuItem Header="Настройки" Name="SettingsMenuItem" Click="SettingsMenuItem_Click"/>
            </MenuItem>
        </Menu>
        
        <!-- Основная область -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1100"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Панель настроек -->
            <Canvas Grid.Column="0" Margin="20">
                <!-- Панель настроек элемента -->
                <Border x:Name="ElementSettingsBorder" 
                        Width="400"
                        Height="500"
                        Canvas.Left="0"
                        Canvas.Top="0"
                        Background="{StaticResource DarkPanelBrush}"
                        CornerRadius="12"
                        BorderBrush="{StaticResource DarkBorderBrush}"
                        BorderThickness="2"
                        MouseLeftButtonDown="ElementSettingsBorder_MouseLeftButtonDown"
                        MouseMove="ElementSettingsBorder_MouseMove"
                        MouseLeftButtonUp="ElementSettingsBorder_MouseLeftButtonUp">
                    <Grid>
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="10">
                            <StackPanel Name="ElementSettingsPanel">
                            <!-- Заголовок с кнопками навигации и переименования -->
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Кнопка назад -->
                                <Button x:Name="PreviousElementButton"
                                      Grid.Column="0"
                                      Content="◀"
                                      Width="30"
                                      Height="30"
                                      Background="{StaticResource PrimaryAccentBrush}"
                                      Foreground="White"
                                      BorderBrush="{StaticResource PrimaryAccentHoverBrush}"
                                      BorderThickness="1"
                                      Click="PreviousElementButton_Click"
                                      ToolTip="Предыдущий элемент"
                                      Visibility="Collapsed"
                                      Margin="0,0,5,0"/>
                                
                                <TextBlock x:Name="ElementTitleText"
                                         Grid.Column="1"
                                         Text="Настройки элемента"
                                         FontSize="18"
                                         FontWeight="Bold"
                                         Foreground="{StaticResource TextPrimaryBrush}"
                                         VerticalAlignment="Center"
                                         HorizontalAlignment="Center"/>
                                
                                <!-- Кнопка вперед -->
                                <Button x:Name="NextElementButton"
                                      Grid.Column="2"
                                      Content="▶"
                                      Width="30"
                                      Height="30"
                                      Background="{StaticResource PrimaryAccentBrush}"
                                      Foreground="White"
                                      BorderBrush="{StaticResource PrimaryAccentHoverBrush}"
                                      BorderThickness="1"
                                      Click="NextElementButton_Click"
                                      ToolTip="Следующий элемент"
                                      Visibility="Collapsed"
                                      Margin="5,0,0,0"/>
                            </Grid>
                            
                            <!-- Кнопка переименования (отдельно) -->
                            <Button x:Name="RenameElementButton"
                                  Content="✏️ Переименовать"
                                  Width="120"
                                  Height="30"
                                  Background="{StaticResource PrimaryAccentBrush}"
                                  Foreground="White"
                                  BorderBrush="{StaticResource PrimaryAccentHoverBrush}"
                                  BorderThickness="1"
                                  Click="RenameElementButton_Click"
                                  ToolTip="Переименовать элемент"
                                  Visibility="Collapsed"
                                  HorizontalAlignment="Center"
                                  Margin="0,0,0,15"/>
                            
                            <!-- Сообщение, когда элемент не выбран -->
                            <TextBlock x:Name="NoElementSelectedText"
                                     Text="Выберите элемент для настройки"
                                     FontSize="14"
                                     Foreground="{StaticResource TextSecondaryBrush}"
                                     HorizontalAlignment="Center"
                                     Margin="0,50,0,0"/>
                            
                            <!-- Панель настроек (скрыта по умолчанию) -->
                            <StackPanel x:Name="SettingsContentPanel" Visibility="Collapsed">
                                
                                <!-- Скорость воспроизведения -->
                                <GroupBox x:Name="SpeedGroupBox" Header="Скорость воспроизведения" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <!-- Слайдер скорости -->
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="0.1x" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                            <Slider x:Name="SpeedSlider"
                                                  Grid.Column="1"
                                                  Minimum="0.1"
                                                  Maximum="10"
                                                  Value="1"
                                                  TickFrequency="0.1"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="SpeedSlider_ValueChanged"
                                                  PreviewMouseLeftButtonUp="SpeedSlider_PreviewMouseLeftButtonUp"/>
                                            <TextBlock Grid.Column="2" Text="10x" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock x:Name="SpeedValueText"
                                                 Text="Скорость: 1.0x"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 HorizontalAlignment="Center"
                                                 Margin="0,0,0,10"/>
                                        
                                        <!-- Предустановленные значения скорости -->
                                        <WrapPanel HorizontalAlignment="Center">
                                            <Button Content="0.5x" Tag="0.5" Click="SpeedPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="1x" Tag="1" Click="SpeedPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="2x" Tag="2" Click="SpeedPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="3x" Tag="3" Click="SpeedPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="5x" Tag="5" Click="SpeedPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="10x" Tag="10" Click="SpeedPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                        </WrapPanel>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Управление воспроизведением -->
                                <GroupBox Header="Управление воспроизведением" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <WrapPanel HorizontalAlignment="Center" Margin="0,10,0,10">
                                        <Button x:Name="PreviousMediaButton" Content="⏮️" Click="PreviousMediaButton_Click" Style="{StaticResource MenuButtonStyle}" Margin="2" ToolTip="Предыдущее медиа"/>
                                        <Button x:Name="ElementPlayButton" Content="▶️" Click="ElementPlay_Click" Style="{StaticResource MenuButtonStyle}" Margin="2" ToolTip="Воспроизвести"/>
                                        <Button x:Name="ElementRestartButton" Content="⏮️" Click="ElementRestart_Click" Style="{StaticResource MenuButtonStyle}" Margin="2" ToolTip="Заново"/>
                                        <Button x:Name="NextMediaButton" Content="⏭️" Click="NextMediaButton_Click" Style="{StaticResource MenuButtonStyle}" Margin="2" ToolTip="Следующее медиа"/>
                                    </WrapPanel>
                                </GroupBox>
                                
                                <!-- Прозрачность -->
                                <GroupBox x:Name="OpacityGroupBox" Header="Прозрачность" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="0%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                            <Slider x:Name="OpacitySlider"
                                                  Grid.Column="1"
                                                  Minimum="0"
                                                  Maximum="1"
                                                  Value="1"
                                                  TickFrequency="0.01"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="OpacitySlider_ValueChanged"/>
                                            <TextBlock Grid.Column="2" Text="100%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock x:Name="OpacityValueText"
                                                 Text="Прозрачность: 100%"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Уровень звука -->
                                <GroupBox x:Name="VolumeGroupBox" Header="Уровень звука" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="0%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                            <Slider x:Name="VolumeSlider"
                                                  Grid.Column="1"
                                                  Minimum="0"
                                                  Maximum="1"
                                                  Value="1"
                                                  TickFrequency="0.01"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="VolumeSlider_ValueChanged"/>
                                            <TextBlock Grid.Column="2" Text="100%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock x:Name="VolumeValueText"
                                                 Text="Звук: 100%"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 HorizontalAlignment="Center"
                                                 Margin="0,0,0,10"/>
                                        
                                        <!-- Предустановленные значения звука -->
                                        <WrapPanel HorizontalAlignment="Center">
                                            <Button Content="10%" Tag="0.1" Click="VolumePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="25%" Tag="0.25" Click="VolumePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="50%" Tag="0.5" Click="VolumePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="75%" Tag="0.75" Click="VolumePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="100%" Tag="1" Click="VolumePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                        </WrapPanel>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Масштаб -->
                                <GroupBox Header="Масштаб" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="10%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                            <Slider x:Name="ScaleSlider"
                                                  Grid.Column="1"
                                                  Minimum="0.1"
                                                  Maximum="5.0"
                                                  Value="1.0"
                                                  TickFrequency="0.1"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="ScaleSlider_ValueChanged"/>
                                            <TextBlock Grid.Column="2" Text="500%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock x:Name="ScaleValueText"
                                                 Text="Масштаб: 100%"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 HorizontalAlignment="Center"
                                                 Margin="0,0,0,10"/>
                                        
                                        <!-- Предустановленные значения масштаба -->
                                        <WrapPanel HorizontalAlignment="Center">
                                            <Button Content="25%" Tag="0.25" Click="ScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="50%" Tag="0.5" Click="ScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="75%" Tag="0.75" Click="ScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="100%" Tag="1.0" Click="ScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="150%" Tag="1.5" Click="ScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="200%" Tag="2.0" Click="ScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                        </WrapPanel>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Поворот -->
                                <GroupBox Header="Поворот" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="-360°" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                            <Slider x:Name="RotationSlider"
                                                  Grid.Column="1"
                                                  Minimum="-360"
                                                  Maximum="360"
                                                  Value="0"
                                                  TickFrequency="5"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="RotationSlider_ValueChanged"/>
                                            <TextBlock Grid.Column="2" Text="360°" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock x:Name="RotationValueText"
                                                 Text="Поворот: 0°"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 HorizontalAlignment="Center"
                                                 Margin="0,0,0,10"/>
                                        
                                        <!-- Предустановленные значения поворота -->
                                        <WrapPanel HorizontalAlignment="Center">
                                            <Button Content="0°" Tag="0" Click="RotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="90°" Tag="90" Click="RotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="180°" Tag="180" Click="RotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="270°" Tag="270" Click="RotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="-90°" Tag="-90" Click="RotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="-180°" Tag="-180" Click="RotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                        </WrapPanel>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Настройки текста (только для текстовых блоков) -->
                                <GroupBox x:Name="TextSettingsGroupBox" Header="Настройки текста" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15"
                                        Visibility="Collapsed">
                                    <StackPanel>
                                        <!-- Кнопка скрытия/показа текста -->
                                        <Button x:Name="HideTextButton"
                                              Content="👁️ Скрыть текст"
                                              Width="150"
                                              Height="35"
                                              Background="{StaticResource DangerBrush}"
                                              Foreground="White"
                                              BorderBrush="{StaticResource DangerBrush}"
                                              BorderThickness="1"
                                              Click="HideTextButton_Click"
                                              ToolTip="Скрыть/показать текст на медиаплеере"
                                              HorizontalAlignment="Center"
                                              Margin="0,10,0,15"/>
                                        
                                        <!-- Цвет текста -->
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Цвет текста:" Foreground="#D8DEE9" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <ComboBox x:Name="TextColorComboBox"
                                                    Grid.Column="1"
                                                    SelectedIndex="0"
                                                    SelectionChanged="TextColorComboBox_SelectionChanged">
                                                <ComboBoxItem Content="Белый" Tag="White"/>
                                                <ComboBoxItem Content="Черный" Tag="Black"/>
                                                <ComboBoxItem Content="Красный" Tag="Red"/>
                                                <ComboBoxItem Content="Зеленый" Tag="Green"/>
                                                <ComboBoxItem Content="Синий" Tag="Blue"/>
                                                <ComboBoxItem Content="Желтый" Tag="Yellow"/>
                                                <ComboBoxItem Content="Оранжевый" Tag="Orange"/>
                                                <ComboBoxItem Content="Фиолетовый" Tag="Purple"/>
                                            </ComboBox>
                                        </Grid>
                                        
                                        <!-- Шрифт -->
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Шрифт:" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <ComboBox x:Name="FontFamilyComboBox"
                                                    Grid.Column="1"
                                                    SelectedIndex="0"
                                                    SelectionChanged="FontFamilyComboBox_SelectionChanged">
                                                <ComboBoxItem Content="Arial" Tag="Arial"/>
                                                <ComboBoxItem Content="Times New Roman" Tag="Times New Roman"/>
                                                <ComboBoxItem Content="Calibri" Tag="Calibri"/>
                                                <ComboBoxItem Content="Verdana" Tag="Verdana"/>
                                                <ComboBoxItem Content="Georgia" Tag="Georgia"/>
                                                <ComboBoxItem Content="Comic Sans MS" Tag="Comic Sans MS"/>
                                                <ComboBoxItem Content="Impact" Tag="Impact"/>
                                                <ComboBoxItem Content="Trebuchet MS" Tag="Trebuchet MS"/>
                                            </ComboBox>
                                        </Grid>
                                        
                                        <!-- Размер шрифта -->
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Размер шрифта:" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <Slider x:Name="FontSizeSlider"
                                                  Grid.Column="1"
                                                  Minimum="12"
                                                  Maximum="72"
                                                  Value="24"
                                                  TickFrequency="2"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="FontSizeSlider_ValueChanged"/>
                                            <TextBlock x:Name="FontSizeValueText" Grid.Column="2" Text="24px" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                        </Grid>
                                        
                                        <!-- Содержимое текста -->
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Содержимое:" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <TextBox x:Name="TextContentTextBox"
                                                   Grid.Column="1"
                                                   Text=""
                                                   TextChanged="TextContentTextBox_TextChanged"
                                                   MinHeight="60"
                                                   TextWrapping="Wrap"
                                                   AcceptsReturn="True"
                                                   VerticalScrollBarVisibility="Auto"/>
                                        </Grid>
                                        
                                        <!-- Ручная настройка положения -->
                                        <CheckBox x:Name="UseManualPositionCheckBox"
                                                Content="Ручная настройка положения"
                                                Foreground="{StaticResource TextSecondaryBrush}"
                                                Margin="0,10,0,10"
                                                Checked="UseManualPositionCheckBox_Checked"
                                                Unchecked="UseManualPositionCheckBox_Unchecked"/>
                                        
                                        <!-- Ручные координаты (скрыты по умолчанию) -->
                                        <StackPanel x:Name="ManualPositionPanel" Visibility="Collapsed">
                                            <Grid Margin="0,0,0,5">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="X:" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                <TextBox x:Name="TextXTextBox"
                                                       Grid.Column="1"
                                                       Text="0"
                                                       TextChanged="TextXTextBox_TextChanged"/>
                                            </Grid>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="Y:" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                <TextBox x:Name="TextYTextBox"
                                                       Grid.Column="1"
                                                       Text="0"
                                                       TextChanged="TextYTextBox_TextChanged"/>
                                            </Grid>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>
                                
                            </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                        
                        <!-- Маяки для изменения размера -->
                        <!-- Вертикальное растягивание -->
                        <Border Name="ElementSettingsResizeHandleV" 
                                Height="8" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeNS"
                                VerticalAlignment="Bottom"
                                Opacity="0.7"
                                MouseEnter="ElementSettingsResizeHandleV_MouseEnter"
                                MouseLeave="ElementSettingsResizeHandleV_MouseLeave"
                                MouseLeftButtonDown="ElementSettingsResizeHandleV_MouseLeftButtonDown"
                                MouseMove="ElementSettingsResizeHandleV_MouseMove"
                                MouseLeftButtonUp="ElementSettingsResizeHandleV_MouseLeftButtonUp"/>
                        
                        <!-- Горизонтальное растягивание -->
                        <Border Name="ElementSettingsResizeHandleH" 
                                Width="8" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeWE"
                                HorizontalAlignment="Right"
                                Opacity="0.7"
                                MouseEnter="ElementSettingsResizeHandleH_MouseEnter"
                                MouseLeave="ElementSettingsResizeHandleH_MouseLeave"
                                MouseLeftButtonDown="ElementSettingsResizeHandleH_MouseLeftButtonDown"
                                MouseMove="ElementSettingsResizeHandleH_MouseMove"
                                MouseLeftButtonUp="ElementSettingsResizeHandleH_MouseLeftButtonUp"/>
                        
                        <!-- Диагональное растягивание -->
                        <Border Name="ElementSettingsResizeHandleD" 
                                Width="12" 
                                Height="12" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeNWSE"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Opacity="0.7"
                                MouseEnter="ElementSettingsResizeHandleD_MouseEnter"
                                MouseLeave="ElementSettingsResizeHandleD_MouseLeave"
                                MouseLeftButtonDown="ElementSettingsResizeHandleD_MouseLeftButtonDown"
                                MouseMove="ElementSettingsResizeHandleD_MouseMove"
                                MouseLeftButtonUp="ElementSettingsResizeHandleD_MouseLeftButtonUp"/>
                    </Grid>
                </Border>
                
                <!-- Панель общих настроек проекта -->
                <Border x:Name="GlobalSettingsBorder" 
                        Width="400"
                        Height="500"
                        Canvas.Left="420"
                        Canvas.Top="0"
                        Background="{StaticResource DarkPanelBrush}"
                        CornerRadius="12"
                        BorderBrush="{StaticResource DarkBorderBrush}"
                        BorderThickness="2"
                        MouseLeftButtonDown="GlobalSettingsBorder_MouseLeftButtonDown"
                        MouseMove="GlobalSettingsBorder_MouseMove"
                        MouseLeftButtonUp="GlobalSettingsBorder_MouseLeftButtonUp">
                    <Grid>
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="10">
                            <StackPanel Name="GlobalSettingsPanel">
                                <!-- Заголовок -->
                                <TextBlock Text="Общие настройки проекта"
                                         FontSize="18"
                                         FontWeight="Bold"
                                         Foreground="{StaticResource TextPrimaryBrush}"
                                         HorizontalAlignment="Center"
                                         Margin="0,0,0,20"/>
                                
                                <!-- Режим хранения медиафайлов -->
                                <GroupBox Header="Режим хранения медиафайлов" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <TextBlock Text="Выберите способ хранения медиафайлов в проекте:"
                                                 Foreground="{StaticResource TextSecondaryBrush}"
                                                 TextWrapping="Wrap"
                                                 Margin="0,0,0,10"/>
                                        
                                        <RadioButton x:Name="StorageModePathsRadio"
                                                   Content="Пути к файлам (экономно, но файлы должны оставаться на месте)"
                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                   Margin="0,5,0,5"
                                                   Tag="Paths"
                                                   Checked="StorageModeRadio_Checked"/>
                                        
                                        <RadioButton x:Name="StorageModeEmbeddedRadio"
                                                   Content="Копировать в папку проекта (занимает место, но проект полностью автономен)"
                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                   Margin="0,5,0,5"
                                                   Tag="Embedded"
                                                   Checked="StorageModeRadio_Checked"/>
                                        
                                        <TextBlock x:Name="StorageModeInfoText"
                                                 Text="Текущий режим: Пути к файлам"
                                                 Foreground="{StaticResource SecondaryAccentBrush}"
                                                 FontSize="11"
                                                 TextWrapping="Wrap"
                                                 Margin="0,10,0,0"/>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Общая громкость -->
                                <GroupBox Header="Общая громкость" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <CheckBox x:Name="UseGlobalVolumeCheckBox"
                                                Content="Использовать общую громкость"
                                                Foreground="{StaticResource TextSecondaryBrush}"
                                                Margin="0,0,0,10"
                                                Checked="UseGlobalVolumeCheckBox_Changed"
                                                Unchecked="UseGlobalVolumeCheckBox_Changed"/>
                                        
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="0%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                            <Slider x:Name="GlobalVolumeSlider"
                                                  Grid.Column="1"
                                                  Minimum="0"
                                                  Maximum="1"
                                                  Value="1"
                                                  TickFrequency="0.01"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="GlobalVolumeSlider_ValueChanged"/>
                                            <TextBlock Grid.Column="2" Text="100%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock x:Name="GlobalVolumeValueText"
                                                 Text="Общая громкость: 100%"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 HorizontalAlignment="Center"
                                                 Margin="0,0,0,10"/>
                                        
                                        <!-- Предустановленные значения общей громкости -->
                                        <WrapPanel HorizontalAlignment="Center">
                                            <Button Content="10%" Tag="0.1" Click="GlobalVolumePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="25%" Tag="0.25" Click="GlobalVolumePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="50%" Tag="0.5" Click="GlobalVolumePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="75%" Tag="0.75" Click="GlobalVolumePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="100%" Tag="1" Click="GlobalVolumePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                        </WrapPanel>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Общая прозрачность -->
                                <GroupBox Header="Общая прозрачность" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <CheckBox x:Name="UseGlobalOpacityCheckBox"
                                                Content="Использовать общую прозрачность"
                                                Foreground="{StaticResource TextSecondaryBrush}"
                                                Margin="0,0,0,10"
                                                Checked="UseGlobalOpacityCheckBox_Changed"
                                                Unchecked="UseGlobalOpacityCheckBox_Changed"/>
                                        
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="0%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                            <Slider x:Name="GlobalOpacitySlider"
                                                  Grid.Column="1"
                                                  Minimum="0"
                                                  Maximum="1"
                                                  Value="1"
                                                  TickFrequency="0.01"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="GlobalOpacitySlider_ValueChanged"/>
                                            <TextBlock Grid.Column="2" Text="100%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock x:Name="GlobalOpacityValueText"
                                                 Text="Общая прозрачность: 100%"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Общий масштаб -->
                                <GroupBox Header="Общий масштаб" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <CheckBox x:Name="UseGlobalScaleCheckBox"
                                                Content="Использовать общий масштаб"
                                                Foreground="{StaticResource TextSecondaryBrush}"
                                                Margin="0,0,0,10"
                                                Checked="UseGlobalScaleCheckBox_Changed"
                                                Unchecked="UseGlobalScaleCheckBox_Changed"/>
                                        
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="10%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                            <Slider x:Name="GlobalScaleSlider"
                                                  Grid.Column="1"
                                                  Minimum="0.1"
                                                  Maximum="5.0"
                                                  Value="1.0"
                                                  TickFrequency="0.1"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="GlobalScaleSlider_ValueChanged"/>
                                            <TextBlock Grid.Column="2" Text="500%" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock x:Name="GlobalScaleValueText"
                                                 Text="Общий масштаб: 100%"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 HorizontalAlignment="Center"
                                                 Margin="0,0,0,10"/>
                                        
                                        <!-- Предустановленные значения общего масштаба -->
                                        <WrapPanel HorizontalAlignment="Center">
                                            <Button Content="25%" Tag="0.25" Click="GlobalScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="50%" Tag="0.5" Click="GlobalScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="75%" Tag="0.75" Click="GlobalScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="100%" Tag="1.0" Click="GlobalScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="150%" Tag="1.5" Click="GlobalScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="200%" Tag="2.0" Click="GlobalScalePreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                        </WrapPanel>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Общий поворот -->
                                <GroupBox Header="Общий поворот" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <CheckBox x:Name="UseGlobalRotationCheckBox"
                                                Content="Использовать общий поворот"
                                                Foreground="{StaticResource TextSecondaryBrush}"
                                                Margin="0,0,0,10"
                                                Checked="UseGlobalRotationCheckBox_Changed"
                                                Unchecked="UseGlobalRotationCheckBox_Changed"/>
                                        
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="-360°" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                            <Slider x:Name="GlobalRotationSlider"
                                                  Grid.Column="1"
                                                  Minimum="-360"
                                                  Maximum="360"
                                                  Value="0"
                                                  TickFrequency="5"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="GlobalRotationSlider_ValueChanged"/>
                                            <TextBlock Grid.Column="2" Text="360°" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock x:Name="GlobalRotationValueText"
                                                 Text="Общий поворот: 0°"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 HorizontalAlignment="Center"
                                                 Margin="0,0,0,10"/>
                                        
                                        <!-- Предустановленные значения общего поворота -->
                                        <WrapPanel HorizontalAlignment="Center">
                                            <Button Content="0°" Tag="0" Click="GlobalRotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="90°" Tag="90" Click="GlobalRotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="180°" Tag="180" Click="GlobalRotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="270°" Tag="270" Click="GlobalRotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="-90°" Tag="-90" Click="GlobalRotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                            <Button Content="-180°" Tag="-180" Click="GlobalRotationPreset_Click" Style="{StaticResource MenuButtonStyle}" Margin="2"/>
                                        </WrapPanel>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Настройки переходов -->
                                <GroupBox Header="Переходы между медиа" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Тип перехода:" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <ComboBox x:Name="TransitionTypeComboBox"
                                                    Grid.Column="1"
                                                    SelectedIndex="0"
                                                    SelectionChanged="TransitionTypeComboBox_SelectionChanged">
                                                <ComboBoxItem Content="Мгновенный"/>
                                                <ComboBoxItem Content="Плавное затухание"/>
                                                <ComboBoxItem Content="Скольжение"/>
                                                <ComboBoxItem Content="Увеличение/уменьшение"/>
                                            </ComboBox>
                                        </Grid>
                                        
                                        <Grid Margin="0,10,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="0.1с" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                            <Slider x:Name="TransitionDurationSlider"
                                                  Grid.Column="1"
                                                  Minimum="0.1"
                                                  Maximum="3.0"
                                                  Value="0.5"
                                                  TickFrequency="0.1"
                                                  IsSnapToTickEnabled="True"
                                                  Margin="10,0,10,0"
                                                  ValueChanged="TransitionDurationSlider_ValueChanged"/>
                                            <TextBlock Grid.Column="2" Text="3.0с" Foreground="#D8DEE9" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock x:Name="TransitionDurationValueText"
                                                 Text="Длительность: 0.5с"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </GroupBox>
                                
                                <!-- Дополнительные настройки -->
                                <GroupBox Header="Дополнительные настройки" 
                                        Foreground="{StaticResource TextPrimaryBrush}" 
                                        BorderBrush="{StaticResource DarkBorderBrush}"
                                        Margin="0,0,0,15">
                                    <StackPanel>
                                        <CheckBox x:Name="AutoPlayNextCheckBox"
                                                Content="Автоматическое воспроизведение следующего элемента"
                                                Foreground="{StaticResource TextSecondaryBrush}"
                                                Margin="0,0,0,10"
                                                Checked="AutoPlayNextCheckBox_Changed"
                                                Unchecked="AutoPlayNextCheckBox_Changed"/>
                                        
                                        <CheckBox x:Name="LoopPlaylistCheckBox"
                                                Content="Зацикливание плейлиста"
                                                Foreground="{StaticResource TextSecondaryBrush}"
                                                Checked="LoopPlaylistCheckBox_Changed"
                                                Unchecked="LoopPlaylistCheckBox_Changed"/>
                                    </StackPanel>
                                </GroupBox>
                                
                            </StackPanel>
                        </ScrollViewer>
                        
                        <!-- Маяки для изменения размера -->
                        <!-- Вертикальное растягивание -->
                        <Border Name="GlobalSettingsResizeHandleV" 
                                Height="8" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeNS"
                                VerticalAlignment="Bottom"
                                Opacity="0.7"
                                MouseEnter="GlobalSettingsResizeHandleV_MouseEnter"
                                MouseLeave="GlobalSettingsResizeHandleV_MouseLeave"
                                MouseLeftButtonDown="GlobalSettingsResizeHandleV_MouseLeftButtonDown"
                                MouseMove="GlobalSettingsResizeHandleV_MouseMove"
                                MouseLeftButtonUp="GlobalSettingsResizeHandleV_MouseLeftButtonUp"/>
                        
                        <!-- Горизонтальное растягивание -->
                        <Border Name="GlobalSettingsResizeHandleH" 
                                Width="8" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeWE"
                                HorizontalAlignment="Right"
                                Opacity="0.7"
                                MouseEnter="GlobalSettingsResizeHandleH_MouseEnter"
                                MouseLeave="GlobalSettingsResizeHandleH_MouseLeave"
                                MouseLeftButtonDown="GlobalSettingsResizeHandleH_MouseLeftButtonDown"
                                MouseMove="GlobalSettingsResizeHandleH_MouseMove"
                                MouseLeftButtonUp="GlobalSettingsResizeHandleH_MouseLeftButtonUp"/>
                        
                        <!-- Диагональное растягивание -->
                        <Border Name="GlobalSettingsResizeHandleD" 
                                Width="12" 
                                Height="12" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeNWSE"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Opacity="0.7"
                                MouseEnter="GlobalSettingsResizeHandleD_MouseEnter"
                                MouseLeave="GlobalSettingsResizeHandleD_MouseLeave"
                                MouseLeftButtonDown="GlobalSettingsResizeHandleD_MouseLeftButtonDown"
                                MouseMove="GlobalSettingsResizeHandleD_MouseMove"
                                MouseLeftButtonUp="GlobalSettingsResizeHandleD_MouseLeftButtonUp"/>
                    </Grid>
                </Border>
            </Canvas>
            
            <!-- Медиаплеер -->
            <Canvas Grid.Column="1" Margin="20">
                <Border x:Name="MediaPlayerBorder" 
                        Width="500"
                        Height="500"
                        Canvas.Left="0"
                        Canvas.Top="0"
                        Background="{StaticResource DarkPanelBrush}"
                        CornerRadius="12"
                        BorderBrush="{StaticResource DarkBorderBrush}"
                        BorderThickness="2"
                        MouseLeftButtonDown="MediaPlayerBorder_MouseLeftButtonDown"
                        MouseMove="MediaPlayerBorder_MouseMove"
                        MouseLeftButtonUp="MediaPlayerBorder_MouseLeftButtonUp">
                    <Grid>
                        <StackPanel>
                            <Border Name="mediaBorder" 
                                    Height="350" 
                                    VerticalAlignment="Top" 
                                    HorizontalAlignment="Stretch"
                                    Margin="10,10,10,10" 
                                    Background="{StaticResource DarkPanelBrush}"
                                    CornerRadius="12"
                                    BorderBrush="{StaticResource DarkBorderBrush}"
                                    BorderThickness="2"
                                    ClipToBounds="True">
                                <Grid ClipToBounds="False"
                                      HorizontalAlignment="Stretch"
                                      VerticalAlignment="Stretch">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Видео (LibVLC) -->
                                    <vlc:VideoView x:Name="vlcVideoView"
                                                   Grid.Row="0" Grid.Column="0"
                                                   HorizontalAlignment="Stretch"
                                                   VerticalAlignment="Stretch"
                                                   Visibility="Collapsed"/>
                                    
                                    <!-- Legacy MediaElement (оставляем для аудио/совместимости, видео переведем на VLC) -->
                                    <MediaElement Name="mediaElement" 
                                                  Grid.Row="0" Grid.Column="0"
                                                  LoadedBehavior="Manual" 
                                                  Stretch="Uniform"
                                                  ScrubbingEnabled="True"
                                                  UnloadedBehavior="Close"
                                                  Visibility="Collapsed"
                                                  MediaFailed="MediaElement_MediaFailed"/>
                                    
                                    <!-- Текстовые блоки поверх медиа -->
                                    <Grid Name="textOverlayGrid" 
                                          Grid.Row="0" Grid.Column="0"
                                          Background="Transparent"
                                          HorizontalAlignment="Stretch"
                                          VerticalAlignment="Stretch"/>
                                </Grid>
                            </Border>
                            
                            <!-- Панель управления медиа -->
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,20,0,20">
                                <!-- Видео таймер -->
                                <TextBlock x:Name="videoTimerText"
                                        FontSize="16"
                                        FontWeight="SemiBold"
                                        HorizontalAlignment="Center"
                                        Text="Видео: 00:00:00.000"
                                        Foreground="{StaticResource TextPrimaryBrush}"
                                        Margin="0,0,0,8"/>
                                
                                <!-- Видео слайдер -->
                                <Slider x:Name="videoSlider"
                                        Width="400"
                                        Height="25"
                                        Minimum="0"
                                        Maximum="100"
                                        Value="0"
                                        Margin="0,0,0,15"
                                        ValueChanged="VideoSlider_ValueChanged"
                                        PreviewMouseLeftButtonDown="VideoSlider_PreviewMouseLeftButtonDown"
                                        PreviewMouseLeftButtonUp="VideoSlider_PreviewMouseLeftButtonUp"/>
                                
                                <!-- Аудио таймер -->
                                <TextBlock x:Name="audioTimerText"
                                        FontSize="16"
                                        FontWeight="SemiBold"
                                        HorizontalAlignment="Center"
                                        Text="Аудио: 00:00:00.000"
                                        Foreground="{StaticResource TextPrimaryBrush}"
                                        Margin="0,0,0,8"/>
                                
                                <!-- Аудио слайдер -->
                                <Slider x:Name="audioSlider"
                                        Width="400"
                                        Height="25"
                                        Minimum="0"
                                        Maximum="100"
                                        Value="0"
                                        Margin="0,0,0,15"
                                        ValueChanged="AudioSlider_ValueChanged"
                                        PreviewMouseLeftButtonDown="AudioSlider_PreviewMouseLeftButtonDown"
                                        PreviewMouseLeftButtonUp="AudioSlider_PreviewMouseLeftButtonUp"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Маяки для изменения размера медиаплеера -->
                        <!-- Вертикальное растягивание -->
                        <Border Name="MediaPlayerResizeHandleV" 
                                Height="8" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeNS"
                                VerticalAlignment="Bottom"
                                Opacity="0.7"
                                MouseEnter="MediaPlayerResizeHandleV_MouseEnter"
                                MouseLeave="MediaPlayerResizeHandleV_MouseLeave"
                                MouseLeftButtonDown="MediaPlayerResizeHandleV_MouseLeftButtonDown"
                                MouseMove="MediaPlayerResizeHandleV_MouseMove"
                                MouseLeftButtonUp="MediaPlayerResizeHandleV_MouseLeftButtonUp"/>
                        
                        <!-- Горизонтальное растягивание -->
                        <Border Name="MediaPlayerResizeHandleH" 
                                Width="8" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeWE"
                                HorizontalAlignment="Right"
                                Opacity="0.7"
                                MouseEnter="MediaPlayerResizeHandleH_MouseEnter"
                                MouseLeave="MediaPlayerResizeHandleH_MouseLeave"
                                MouseLeftButtonDown="MediaPlayerResizeHandleH_MouseLeftButtonDown"
                                MouseMove="MediaPlayerResizeHandleH_MouseMove"
                                MouseLeftButtonUp="MediaPlayerResizeHandleH_MouseLeftButtonUp"/>
                        
                        <!-- Диагональное растягивание -->
                        <Border Name="MediaPlayerResizeHandleD" 
                                Width="12" 
                                Height="12" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeNWSE"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Opacity="0.7"
                                MouseEnter="MediaPlayerResizeHandleD_MouseEnter"
                                MouseLeave="MediaPlayerResizeHandleD_MouseLeave"
                                MouseLeftButtonDown="MediaPlayerResizeHandleD_MouseLeftButtonDown"
                                MouseMove="MediaPlayerResizeHandleD_MouseMove"
                                MouseLeftButtonUp="MediaPlayerResizeHandleD_MouseLeftButtonUp"/>
                    </Grid>
                </Border>
            </Canvas>
        </Grid>
        
        <!-- Кнопки управления -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,10,0,0">
            <!-- <Button Content="Загрузить" Style="{StaticResource MenuButtonStyle}" Click="LoadMedia"/> -->
            <Button Content="Воспроизвести" Style="{StaticResource MenuButtonStyle}" Click="PlayMedia"/>
            <Button Content="Остановить" Style="{StaticResource MenuButtonStyle}" Click="StopMedia"/>
            <!-- <Button Content="Закрыть" Style="{StaticResource MenuButtonStyle}" Click="CloseMedia"/> -->
        </StackPanel>
            
            <!-- Панель медиа-клеток -->
            <Canvas Grid.Row="1" Margin="20">
                <Border x:Name="MediaCellsBorder" 
                        Width="800"
                        Height="300"
                        Canvas.Left="0"
                        Canvas.Bottom="0"
                        Background="{StaticResource DarkPanelBrush}"
                        CornerRadius="12"
                        BorderBrush="{StaticResource DarkBorderBrush}"
                        BorderThickness="2"
                        MouseLeftButtonDown="MediaCellsBorder_MouseLeftButtonDown"
                        MouseMove="MediaCellsBorder_MouseMove"
                        MouseLeftButtonUp="MediaCellsBorder_MouseLeftButtonUp">
                    <Grid>
                        <Grid x:Name="BottomPanel" Margin="10"/>
                        
                        <!-- Маяки для изменения размера панели медиа-клеток -->
                        <!-- Вертикальное растягивание -->
                        <Border Name="MediaCellsResizeHandleV" 
                                Height="8" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeNS"
                                VerticalAlignment="Bottom"
                                Opacity="0.7"
                                MouseEnter="MediaCellsResizeHandleV_MouseEnter"
                                MouseLeave="MediaCellsResizeHandleV_MouseLeave"
                                MouseLeftButtonDown="MediaCellsResizeHandleV_MouseLeftButtonDown"
                                MouseMove="MediaCellsResizeHandleV_MouseMove"
                                MouseLeftButtonUp="MediaCellsResizeHandleV_MouseLeftButtonUp"/>
                        
                        <!-- Горизонтальное растягивание -->
                        <Border Name="MediaCellsResizeHandleH" 
                                Width="8" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeWE"
                                HorizontalAlignment="Right"
                                Opacity="0.7"
                                MouseEnter="MediaCellsResizeHandleH_MouseEnter"
                                MouseLeave="MediaCellsResizeHandleH_MouseLeave"
                                MouseLeftButtonDown="MediaCellsResizeHandleH_MouseLeftButtonDown"
                                MouseMove="MediaCellsResizeHandleH_MouseMove"
                                MouseLeftButtonUp="MediaCellsResizeHandleH_MouseLeftButtonUp"/>
                        
                        <!-- Диагональное растягивание -->
                        <Border Name="MediaCellsResizeHandleD" 
                                Width="12" 
                                Height="12" 
                                Background="{StaticResource PrimaryAccentBrush}" 
                                Cursor="SizeNWSE"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Opacity="0.7"
                                MouseEnter="MediaCellsResizeHandleD_MouseEnter"
                                MouseLeave="MediaCellsResizeHandleD_MouseLeave"
                                MouseLeftButtonDown="MediaCellsResizeHandleD_MouseLeftButtonDown"
                                MouseMove="MediaCellsResizeHandleD_MouseMove"
                                MouseLeftButtonUp="MediaCellsResizeHandleD_MouseLeftButtonUp"/>
                    </Grid>
                </Border>
            </Canvas>
    </Grid>
</Window>
